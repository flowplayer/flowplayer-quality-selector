/*!

 Flowplayer HTML5 quality selector plugin

 Copyright (c) 2016, Flowplayer Oy

 Released under the MIT License:
 http://www.opensource.org/licenses/mit-license.php

 revision: 5b0a2b9

 */
!function(e){e(function(t,i){"use strict";function a(e){return e.sources.some(function(e){return/mpegurl/i.test(e.type)})}function r(e){var t=document.createElement("video");return!!t.canPlayType(e).replace("no","")}function l(e,i){var a=RegExp(t.separator+"(\\d+p)(\\.(mp4|webm))?$").exec(e);if(a&&-1!==i.indexOf(a[1]))return a[1]}function n(){t.qualities&&t.qualities.length&&t.qualities.forEach(function(e){o.removeClass(i,"quality-"+e)})}function u(e,t){if("abr"===e)return"abr";var i,a=parseInt(e,0);return t.forEach(function(e,r){r!=t.length-1||i||(i=e),parseInt(e)<=a&&parseInt(t[r+1])>a&&(i=e)}),i}function s(i,a,r){var l,n=!1,u=a===t.defaultQuality,s=t.quality||Math.min(t.video.height,t.video.width)+"p";l=s===t.defaultQuality?/(.+?)((\.(mp4|webm)$|$))/:new RegExp("("+t.separator+"\\d+p)?((\\.(mp4|webm)$|$))");var o=i.sources.map(function(e){if("abr"===a||r&&u||/mpegurl/i.test(e.type))return e;var i={type:e.type,src:e.src.replace(l,s===t.defaultQuality?"$1"+t.separator+a+"$2":u?"$2":t.separator+a+"$2")};if(i.src!==e.src&&(n=!0),n&&t.defaultQuality===s){var o=i.src.split(t.separator+s);i.src=o[0]+o[1]}return i}),c=JSON.stringify(o);o.sort(function(e,t){var i,r=/mpegurl/i;return i="abr"===a?r.test(t.type)-r.test(e.type):r.test(e.type)-r.test(t.type)}),n=n||JSON.stringify(o)!==c;var f=e.extend({},i,{sources:o});return n?f:!1}var o=e.common,c=!1;t.pluginQualitySelectorEnabled||(t.pluginQualitySelectorEnabled=!0,e.support.inlineVideo&&(t.conf.qualities&&(t.qualities="string"==typeof t.conf.qualities?t.conf.qualities.split(","):t.conf.qualities,t.defaultQuality=t.conf.defaultQuality),t.separator="undefined"!=typeof t.conf.clip.separator?t.conf.clip.separator:"-",e.bean.on(i,"click",".fp-quality-selector li",function(e){if(!/\bactive\b/.test(this.className)){var i,a=t.finished?0:t.video.time,r=e.currentTarget.getAttribute("data-quality");if(i=s(t.video,r),t.quality=r,!i)return;c=!0,t.load(i,function(){c=!1,t.finished=!1,a&&!t.live&&t.seek(a,function(){t.resume()})})}}),t.bind("load",function(e,t,i){if(t.qualities=i.qualities||t.qualities||[],t.defaultQuality=i.defaultQuality||t.defaultQuality,"string"==typeof t.qualities&&(t.qualities=t.qualities.split(",")),t.quality){var a=u(t.quality,t.qualities),r=s(i,a,!c);!c&&r&&(e.preventDefault(),t.loading=!1,t.load(r))}}),t.bind("ready",function(e,t,u){var s=/mpegurl/i.test(u.type)?"abr":l(u.src,t.qualities)||Math.min(u.height,u.width)+"p";n(),t.quality=s,o.addClass(i,"quality-"+s);var c=o.find(".fp-ui",i)[0];if(o.removeNode(o.find(".fp-quality-selector",c)[0]),!(t.qualities.length<2)){var f=o.createElement("ul",{"class":"fp-quality-selector"});c.appendChild(f),(a(u)&&r("application/x-mpegurl")||t.conf.swfHls)&&f.appendChild(o.createElement("li",{"data-quality":"abr","class":"abr"===s?"active":""},"Auto")),t.qualities.forEach(function(e,t){f.appendChild(o.createElement("li",{"data-quality":e,"class":e==s?"active":""},e))})}}),t.bind("unload",function(){n(),o.removeNode(o.find(".fp-quality-selector",i)[0])})))})}("object"==typeof module&&module.exports?require("flowplayer"):window.flowplayer);