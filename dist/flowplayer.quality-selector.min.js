/*!

   Flowplayer HTML5 quality selector plugin

   Copyright (c) 2016, Flowplayer Oy

   Released under the MIT License:
   http://www.opensource.org/licenses/mit-license.php

   revision: 1003945

*/
!function(){"use strict";var t=function(t){t(function(e,i){function a(t){return t.sources.some(function(t){return/mpegurl/i.test(t.type)})}function n(t){var e=document.createElement("video");return!!e.canPlayType(t).replace("no","")}function l(t,e){if("object"==typeof e[0]){var i=/([^\/]*?)(\.([a-zA-Z0-9]*))?$/.exec(t);return e.find(function(t){return t.src===i[1]}).quality}var a=/-(\d+p)(\.(mp4|webm))?$/.exec(t);if(a&&e.indexOf(a[1])!==-1)return a[1]}function u(){e.qualities&&e.qualities.length&&(c.removeClass(i,"quality-abr"),e.qualities.forEach(function(t){c.removeClass(i,"quality-"+(t.quality||t))}))}function r(t,i){if("abr"===t)return"abr";var a,n=parseInt(t,10);return isNaN(n)?i.forEach(function(e,i){"object"==typeof e&&(e=e.quality),t===e&&(a=e)}):i.forEach(function(t,e){"object"==typeof t&&(t=t.quality);var l=i[e+1];"object"==typeof l&&(l=l.quality),parseInt(t,10)<=n&&(parseInt(l,10)>n||!l)&&(a=t)}),a||(a=e.defaultQuality),a}function o(i,a,n){var l,u=!1,r=a===e.defaultQuality,o=e.quality||Math.min(e.video.height,e.video.width)+"p";l=o===e.defaultQuality?/(.+?)((\.(mp4|webm)$|$))/:/(-\d+p)?((\.(mp4|webm)$|$))/;var s=i.sources.map(function(t){if("abr"===a||n&&r||/mpegurl/i.test(t.type))return t;var i={type:t.type,src:"object"==typeof e.qualities[0]?t.src.replace(/[^\/]*?(\.([a-zA-Z0-9]*)$|$)/,e.qualities.find(function(t){return t.quality===a}).src+"$1"):t.src.replace(l,o===e.defaultQuality?"$1-"+a+"$2":r?"$2":"-"+a+"$2")};return i.src!==t.src&&(u=!0),i}),c=JSON.stringify(s);s.sort(function(t,e){var i,n=/mpegurl/i;return i="abr"===a?n.test(e.type)-n.test(t.type):n.test(t.type)-n.test(e.type)}),u=u||JSON.stringify(s)!==c;var f=t.extend({},i,{sources:s});return!!u&&f}var s=t.bean,c=t.common,f=!1,p=!1;e.conf.hlsjs!==!1&&t.engines.forEach(function(t){"hlsjs"===t.engineName&&t.canPlay("application/x-mpegurl",e.conf)&&(p=!0)}),e.pluginQualitySelectorEnabled||(e.pluginQualitySelectorEnabled=!0,t.support.inlineVideo&&(e.conf.qualities&&(e.conf.qualities="string"==typeof e.conf.qualities?e.conf.qualities.split(","):e.conf.qualities),s.on(i,"click",".fp-quality-selector li",function(t){var i=t.currentTarget;if(!c.hasClass(i,"active")){var a,n=e.finished?0:e.video.time,l=i.getAttribute("data-quality");if(a=o(e.video,l),e.quality=l,!a)return;f=!0,p&&a.hlsjs!==!1&&!e.live&&n&&"abr"===l&&(a.hlsjs={startPosition:n}),e.load(a,function(){f=!1,e.finished=!1,!n||e.live||a.hlsjs&&a.hlsjs.startPosition?a.hlsjs&&(a.hlsjs.startPosition=0):e.seek(n,function(){e.resume()})})}}),e.on("load",function(t,e,i){if(e.qualities=i.qualities||e.conf.qualities||[],e.defaultQuality=i.defaultQuality||e.conf.defaultQuality,"string"==typeof e.qualities&&(e.qualities=e.qualities.split(",")),e.quality){var a=r(e.quality,e.qualities),n=o(i,a,!f);!f&&n&&(t.preventDefault(),e.loading=!1,e.load(n))}}).on("ready",function(t,e,r){var o=/mpegurl/i.test(r.type)?"abr":l(r.src,e.qualities)||Math.min(r.height,r.width)+"p";u(),c.addClass(i,"quality-"+o);var s=c.find(".fp-ui",i)[0];if(c.removeNode(c.find(".fp-quality-selector",s)[0]),!(e.qualities.length<2)){e.quality=o;var f=c.createElement("ul",{class:"fp-quality-selector"});s.appendChild(f),(a(r)&&n("application/x-mpegurl")||e.conf.swfHls)&&f.appendChild(c.createElement("li",{"data-quality":"abr",class:"abr"===o?"active":""},"Auto")),e.qualities.forEach(function(t){f.appendChild(c.createElement("li",{"data-quality":t.quality||t,class:(t.quality||t)==o?"active":""},t.quality||t))})}}).on("unload",function(){u(),c.removeNode(c.find(".fp-quality-selector",i)[0])})))})};"object"==typeof module&&module.exports?module.exports=t:window.flowplayer&&t(window.flowplayer)}();