/*!

 Flowplayer HTML5 quality selector plugin

 Copyright (c) 2016, Flowplayer Oy

 Released under the MIT License:
 http://www.opensource.org/licenses/mit-license.php

 revision: 5204be4

 */
!function(e){e(function(t,i){"use strict";function a(e){return e.sources.some(function(e){return/mpegurl/i.test(e.type)})}function l(e){var t=document.createElement("video");return!!t.canPlayType(e).replace("no","")}function r(e,i){var a=RegExp(t.separator+"(\\d+p)(\\.(mp4|webm))?$").exec(e);if(a&&-1!==i.indexOf(a[1]))return a[1]}function u(){t.qualities&&t.qualities.length&&t.qualities.forEach(function(e){o.removeClass(i,"quality-"+e)})}function n(e,t){if("abr"===e)return"abr";var i,a=parseInt(e,0);return t.forEach(function(e,l){l!=t.length-1||i||(i=e),parseInt(e)<=a&&parseInt(t[l+1])>a&&(i=e)}),i}function s(i,a,l){var r,u=!1,n=a===t.defaultQuality,s=t.quality||Math.min(t.video.height,t.video.width)+"p";r=s===t.defaultQuality?/(.+?)((\.(mp4|webm)$|$))/:new RegExp("("+t.separator+"\\d+p)?((\\.(mp4|webm)$|$))");var o=i.sources.map(function(e){if("abr"===a||l&&n||/mpegurl/i.test(e.type))return e;var i={type:e.type,src:e.src.replace(r,s===t.defaultQuality?"$1"+t.separator+a+"$2":n?"$2":t.separator+a+"$2")};if(i.src!==e.src&&(u=!0),u&&t.defaultQuality===s){var o=i.src.split(t.separator+s);i.src=o[0]+o[1]}return i}),c=JSON.stringify(o);o.sort(function(e,t){var i,l=/mpegurl/i;return i="abr"===a?l.test(t.type)-l.test(e.type):l.test(e.type)-l.test(t.type)}),u=u||JSON.stringify(o)!==c;var f=e.extend({},i,{sources:o});return u?f:!1}var o=e.common,c=!1;t.pluginQualitySelectorEnabled||(t.pluginQualitySelectorEnabled=!0,e.support.inlineVideo&&(t.conf.qualities&&(t.qualities="string"==typeof t.conf.qualities?t.conf.qualities.split(","):t.conf.qualities,t.defaultQuality=t.conf.defaultQuality),t.separator="undefined"!=typeof t.conf.clip.separator?t.conf.clip.separator:"-",e.bean.on(i,"click",".fp-quality-selector li",function(e){if(/\bactive\b/.test(this.className)){var a=i.querySelector(".fp-quality-selector");-1==a.className.indexOf("show-click")?a.className="fp-quality-selector show-click":a.className="fp-quality-selector"}else{var l,r=t.finished?0:t.video.time,u=e.currentTarget.getAttribute("data-quality");if(l=s(t.video,u),t.quality=u,!l)return;c=!0,t.load(l,function(){c=!1,t.finished=!1,r&&!t.live&&t.seek(r,function(){t.resume()})})}}),t.bind("load",function(e,t,i){if(t.qualities=i.qualities||t.qualities||[],t.defaultQuality=i.defaultQuality||t.defaultQuality,"string"==typeof t.qualities&&(t.qualities=t.qualities.split(",")),t.quality){var a=n(t.quality,t.qualities),l=s(i,a,!c);!c&&l&&(e.preventDefault(),t.loading=!1,t.load(l))}}),t.bind("ready",function(e,t,n){var s=/mpegurl/i.test(n.type)?"abr":r(n.src,t.qualities)||Math.min(n.height,n.width)+"p";u(),t.quality=s,o.addClass(i,"quality-"+s);var c=o.find(".fp-ui",i)[0];if(o.removeNode(o.find(".fp-quality-selector",c)[0]),!(t.qualities.length<2)){var f=o.createElement("ul",{"class":"fp-quality-selector"});c.appendChild(f),(a(n)&&l("application/x-mpegurl")||t.conf.swfHls)&&f.appendChild(o.createElement("li",{"data-quality":"abr","class":"abr"===s?"active":""},"Auto")),t.qualities.forEach(function(e,t){f.appendChild(o.createElement("li",{"data-quality":e,"class":e==s?"active":""},e))})}}),t.bind("unload",function(){u(),o.removeNode(o.find(".fp-quality-selector",i)[0])})))})}("object"==typeof module&&module.exports?require("flowplayer"):window.flowplayer);